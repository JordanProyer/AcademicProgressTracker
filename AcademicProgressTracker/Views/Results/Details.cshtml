@model AcademicProgressTracker.ViewModels.ResultsAddViewModel
@{
    ViewBag.Title = @Model.Module.Name;
    ViewBag.Message = "Detailed analytics for: " + @Model.Module.Name;
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<h1>@ViewBag.Title</h1>
<p>@ViewBag.Message</p>

<div id="gradesChartContainer" style="height: 370px; width: 80%;"></div>
<br /><br /><br />
<div id="gradesOverTimeChartContainer" style="height: 370px; width: 80%;"></div>
<br /><br /><br />
<div id="maximumgradeChartContainer" style="height: 370px; width: 80%;"></div>
<br /><br /><br />
<div class="form-group">
    @Html.LabelFor(m => m.KnnPredictionNum)
    @Html.DisplayTextFor(m => m.KnnPredictionNum)<br />
    @Html.LabelFor(m => m.KnnPredictionTxt)
    @Html.DisplayTextFor(m => m.KnnPredictionTxt)
</div>

<script>
        window.onload = function() {
            drawMarksGraph();
            drawGradesOverTimeGraph();
            drawMaximumResultGraph();
        }

        function drawMarksGraph() {
            var dataPoints = [];

            var chart = new CanvasJS.Chart("gradesChartContainer",
                {
                    animationEnabled: true,
                    theme: "light2",
                    title: {
                        text: "Coursework Grades"
                    },
                    axisX: {
                        title: "Coursework Name",
                        titleFontSize: 24,
                    },
                    axisY: {
                        title: "Mark achieved (%)",
                        titleFontSize: 24,
                        maximum: 100,
                        interlacedColor: "#D6DCFC"
                    },

                    toolTip: {
                        shared: true
                    },
                    data: [
                        {
                            type: "column",
                            name: "Current Mark (%)",
                            dataPoints: dataPoints
                        },
                    ]
                });

            function addData(data) {
                for (var i = 0; i < data.length; i++) {
                    dataPoints.push({
                        label: data[i].Name,
                        y: data[i].Mark
                    });
                }
                chart.render();

            }

            var moduleId = @Model.Module.Id;
            var url = '@Url.Action("GetCourseworkGrades", "Results")' + '?moduleId=' + moduleId;
            $.getJSON(url, addData);
    }


        function drawGradesOverTimeGraph() {
            var dataPoints = [];
            var dataPoints2 = [];

            var chart = new CanvasJS.Chart("gradesOverTimeChartContainer",
                {
                    animationEnabled: true,
                    theme: "light2",
                    title: {
                        text: "Coursework Grades Over Time"
                    },
                    axisX: {
                        title: "Date",
                        titleFontSize: 24,
                    },
                    axisY: {
                        title: "Mark achieved (%)",
                        titleFontSize: 24,
                        maximum: 100,
                        interlacedColor: "#D6DCFC"
                    },
                    axisY2: {
                        title: "Cumulative Weighted Mark (%)",
                        titleFontColor: "#C0504E",
                        lineColor: "#C0504E",
                        tickColor: "#C0504E",
                        maximum: 100,
                    },
                    toolTip: {
                        shared: true
                    },
                    legend: {
                        cursor:"pointer",
                        itemclick: toggleDataSeries
                    },
                    data: [
                        {
                            type: "line",
                            xValueType: "dateTime",
                            name: "Coursework Mark (%)",
                            showInLegend: true,
                            dataPoints: dataPoints
                        },
                        {
                            type: "line",
                            xValueType: "dateTime",
                            name: "Cumulative Weighted Mark (%)",
                            showInLegend: true,
                            axisYType: "secondary",
                            color: "#C0504E",
                            dataPoints: dataPoints2
                        }
                    ]
                });

            function addData(data) {
                for (var i = 0; i < data.length; i++) {
                    dataPoints.push({
                        x: new Date(data[i].AddedDateTime),
                        y: data[i].Mark
                    });
                    dataPoints2.push({
                        x: new Date(data[i].AddedDateTime),
                        y: data[i].WeightedMark
                    });
                }
                chart.render();

            }

            function toggleDataSeries(e) {
                if (typeof(e.dataSeries.visible) === "undefined" || e.dataSeries.visible) {
                    e.dataSeries.visible = false;
                }
                else {
                    e.dataSeries.visible = true;
                }
                chart.render();
            }

            var moduleId = @Model.Module.Id;
            var url = '@Url.Action("GetCourseworkGradesOverTime", "Results")' + '?moduleId=' + moduleId;
            $.getJSON(url, addData);
        }





        function drawMaximumResultGraph() {
            debugger;
            var dataPoints = [];
            var dataPoints2 = [];

            var chart = new CanvasJS.Chart("maximumgradeChartContainer",
                {
                    animationEnabled: true,
                    theme: "light2",
                    title: {
                        text: "Best possible Grade"
                    },
                    axisX: {
                        title: "Module",
                        titleFontSize: 24,
                    },
                    axisY: {
                        title: "Weighted Mark (%)",
                        titleFontColor: "#4F81BC",
                        lineColor: "#4F81BC",
                        labelFontColor: "#4F81BC",
                        tickColor: "#4F81BC",
                        interlacedColor: "#F8F1E4",
                        titleFontSize: 24,
                        maximum: 100
                    },
                    axisY2: {
                        title: "Maximum Possible Mark (%)",
                        titleFontColor: "#C0504E",
                        lineColor: "#C0504E",
                        tickColor: "#C0504E",
                        maximum: 100,
                    },
                    toolTip: {
                        shared: true
                    },
                    legend: {
                        cursor:"pointer",
                        itemclick: toggleDataSeries
                    },
                    data: [
                        {
                            type: "column",
                            name: "Current Weighted Mark (%)",
                            legendText: "Current Weighted Mark (%)",
                            showInLegend: true,
                            dataPoints: dataPoints
                        },
                            {
                                type: "column",
                                name: "Best Possible Weighted Mark (%)",
                                legendText: "Best Possible Weighted Mark (%)",
                                showInLegend: true,
                                axisYType: "secondary",
                                color: "#C0504E",
                                dataPoints: dataPoints2
                            }
                    ]
                });

            function addData(data) {
                for (var i = 0; i < data.length; i++) {
                    dataPoints.push({
                        label: "Grades",
                        y: data[i].CurrentWeightedMark
                    });
                    dataPoints2.push({
                        label: "Grades",
                        y: data[i].MaximumWeightedMark
                    });
                }
                chart.render();

            }

            function toggleDataSeries(e) {
                if (typeof(e.dataSeries.visible) === "undefined" || e.dataSeries.visible) {
                    e.dataSeries.visible = false;
                }
                else {
                    e.dataSeries.visible = true;
                }
                chart.render();
            }

            var moduleId = @Model.Module.Id;
            var url = '@Url.Action("GetMaximumWeightedGrade", "Results")' + '?moduleId=' + moduleId;
            $.getJSON(url, addData);
        }  
</script>
